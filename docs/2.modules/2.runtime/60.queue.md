---
icon: i-lucide-list-plus
---
# queue

> Enqueue messages with a unified API across Vercel Queues, Cloudflare Queues, Upstash QStash, and a local in-memory provider.

## Usage
```ts
import { createQueue } from 'unagent/queue'
```

### Installation
Install `unagent` and the provider SDK for your platform:

::code-group
```bash [Vercel]
pnpm add unagent @vercel/queue
```
```bash [Cloudflare]
pnpm add unagent
```
```bash [QStash]
pnpm add unagent @upstash/qstash
```
::

### Quick Start
#### Vercel

```ts
import { createQueue } from 'unagent/queue'

const queue = await createQueue({
  provider: { name: 'vercel', topic: 'my-topic' },
})

const { messageId } = await queue.send({ hello: 'world' }, { delaySeconds: 60 })
```

#### Cloudflare Workers

```ts
import { createQueue } from 'unagent/queue'

export default {
  async fetch(_req: Request, env: Env) {
    const queue = await createQueue({
      provider: { name: 'cloudflare', binding: env.MY_QUEUE },
    })

    await queue.send({ hello: 'world' }, { contentType: 'json', delaySeconds: 10 })

    if (queue.supports.sendBatch) {
      await queue.sendBatch?.([{ body: { ok: true }, contentType: 'json' }], { delaySeconds: 10 })
    }

    return new Response('ok')
  },
}
```

#### Local Dev (memory)

```ts
import { createQueue } from 'unagent/queue'

const queue = await createQueue({
  provider: { name: 'memory' },
})

await queue.send({ hello: 'world' })
await queue.memory.drain(async (msg) => {
  // consume message
})
```

## API

### Unified API
```ts
interface QueueClient {
  readonly provider: 'vercel' | 'cloudflare' | 'qstash' | 'memory'
  readonly supports: { sendBatch: boolean }

  send: (payload: unknown, options?: Record<string, unknown>) => Promise<{ messageId?: string }>
  sendBatch?: (messages: { body: unknown, contentType?: 'text' | 'bytes' | 'json' | 'v8' }[], options?: { delaySeconds?: number }) => Promise<void>
}
```

### Capabilities
```ts
if (queue.supports.sendBatch) {
  await queue.sendBatch?.([{ body: 'hello', contentType: 'text' }])
}
```

## Related
- [All Modules](/modules)

## Providers

See [queue providers](/modules/providers/queue).
