---
icon: i-lucide-folder-symlink
---
# link

> File copy and symlink utilities with safety checks.

## What It Solves

Installing skills and managing agent assets often involves copying directories or creating symlinks. The `link` module provides these operations with basic safety checks and predictable return values. Use it to avoid reimplementing recursive copy logic and platform quirks.

## When To Use It

- You need to copy a skill directory into an agent’s skills folder.
- You want to create symlinks with optional overwrite behavior.
- You want to sanitize user-provided names for filesystem paths.

## Usage
```ts
import { copyDirectory, createSymlink, sanitizeName } from 'unagent/link'
```

## API

### Copying
#### `copyDirectory(src, dest, options?)`

Copy a directory recursively.

```ts
const result = copyDirectory('./source', './dest', {
  force: false, // Overwrite if exists (default: false)
  exclude: ['.git', 'node_modules', '.DS_Store', 'Thumbs.db'], // Exclude patterns
  preserveTimestamps: true, // Keep original timestamps (default: true)
})

if (result.success) {
  console.log(`Copied ${result.filesCopied} files`)
}
else {
  console.error(result.error)
}
```

### `copyFile(src, dest, options?)`

Copy a single file.

```ts
copyFile('./src/file.ts', './dest/file.ts', { force: true })
// → true if success
```

### `getDirectorySize(dir)`

Get total size of directory in bytes.

```ts
const size = getDirectorySize('./my-folder')
console.log(`Size: ${size} bytes`)
```

### Symlinks
#### `createSymlink(target, linkPath, options?)`

Create a symlink safely.

```ts
const result = createSymlink('./target', './link', {
  force: false, // Overwrite existing (default: false)
  relative: true, // Use relative path (default: true)
})

if (result.success) {
  console.log(`Created symlink at ${result.path}`)
}
```

> [!NOTE]
> On Windows, directories are linked as junctions for better compatibility.

### `isSymlink(path)`

Check if path is a symlink.

```ts
if (isSymlink('./my-link')) {
  console.log('Is a symlink')
}
```

### `removeSymlink(linkPath)`

Remove a symlink.

```ts
removeSymlink('./my-link') // true if removed
```

### Sanitization
#### `sanitizeName(name)`

Sanitize a name for use as filename.

```ts
sanitizeName('My Skill!') // "my-skill"
sanitizeName('test__name') // "test-name"
sanitizeName('UPPER-case') // "upper-case"
```

Transforms:
- Lowercase
- Replace non-alphanumeric with `-`
- Collapse multiple `-`
- Trim leading/trailing `-`
- Max 100 characters

### `isPathSafe(targetPath, baseDir)`

Check if a path is safe (doesn't escape baseDir).

```ts
isPathSafe('sub/dir', '/base') // true
isPathSafe('../escape', '/base') // false
isPathSafe('/absolute', '/base') // false
```

### `validateSymlinkTarget(target)`

Validate symlink target is safe.

```ts
validateSymlinkTarget('./valid') // true
validateSymlinkTarget('') // false
validateSymlinkTarget('a'.repeat(5000)) // false (too long)
```

### Types
```ts
interface CopyOptions {
  force?: boolean // Overwrite existing
  exclude?: string[] // Patterns to exclude
  preserveTimestamps?: boolean
}

interface CopyResult {
  success: boolean
  src: string
  dest: string
  filesCopied?: number
  error?: string
}

interface SymlinkOptions {
  force?: boolean // Overwrite existing
  relative?: boolean // Use relative paths
}

interface SymlinkResult {
  success: boolean
  path: string
  target: string
  error?: string
}
```

## Examples

### Example: Install Skill
```ts
import { join } from 'pathe'
import { copyDirectory, sanitizeName } from 'unagent/link'

function installSkill(sourcePath: string, skillsDir: string, name: string) {
  const safeName = sanitizeName(name)
  const dest = join(skillsDir, safeName)

  const result = copyDirectory(sourcePath, dest, {
    force: true,
    exclude: ['.git', 'node_modules', 'README.md'],
  })

  if (!result.success) {
    throw new Error(`Install failed: ${result.error}`)
  }

  return dest
}
```

## Related
- [Core](/core)
- [fs](/core/fs)
- [skill](/core/skill)
