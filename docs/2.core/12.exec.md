---
icon: i-lucide-terminal
---
# exec

> Safe command execution with timeout and output truncation.

## What It Solves

Agents often need to run external tools, but raw process execution can hang, flood output, or leak environment assumptions. The `exec` module wraps process execution with guardrails like timeouts and output limits. Use it when you want predictable behavior and structured results.

## When To Use It

- You run CLI tools from an agent loop and need timeouts to avoid hanging.
- You want bounded stdout/stderr for logs, UI, or prompt inclusion.
- You need a consistent result shape for async and sync execution.

## Usage
```ts
import { execSafe, execSafeSync } from 'unagent/exec'
```

## API

### Async Execution
#### `execSafe(command, args, options?)`

Execute a command asynchronously with safety guards.

```ts
const result = await execSafe('ls', ['-la'])

if (result.ok) {
  console.log(result.stdout)
}
else {
  console.error(result.stderr)
}
```

With options:

```ts
const result = await execSafe('npm', ['install'], {
  cwd: '/path/to/project',
  timeout: 60_000,
  maxOutput: 50_000,
  env: { NODE_ENV: 'production' },
})
```

With stdin:

```ts
const result = await execSafe('cat', [], { stdin: 'hello world' })
// result.stdout â†’ "hello world"
```

### Sync Execution
#### `execSafeSync(command, args, options?)`

Execute a command synchronously. Same options except `stdin`.

```ts
const result = execSafeSync('git', ['status'])

if (result.ok) {
  console.log(result.stdout)
}
```

### Options
| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `cwd` | `string` | `process.cwd()` | Working directory |
| `timeout` | `number` | `30000` | Timeout in ms (0 = no timeout) |
| `maxOutput` | `number` | `100000` | Max output chars before truncation |
| `env` | `Record<string, string>` | `process.env` | Environment variables (merged with process.env) |
| `stdin` | `string` | - | Input to write to stdin (async only) |

### Result
```ts
interface ExecResult {
  ok: boolean // true if exit code === 0
  code: number | null // exit code (null if process errored)
  stdout: string // stdout output (trimmed)
  stderr: string // stderr output (trimmed)
  signal: string | null // signal if killed (e.g., "SIGTERM")
  truncated: boolean // true if output exceeded maxOutput
  timedOut: boolean // true if timeout reached
}
```

## Examples

### Example: Git Operations
```ts
import { execSafe } from 'unagent/exec'

async function gitStatus(repo: string) {
  const result = await execSafe('git', ['status', '--porcelain'], {
    cwd: repo,
    timeout: 10_000,
  })

  if (!result.ok) {
    throw new Error(`git failed: ${result.stderr}`)
  }

  return result.stdout.split('\n').filter(Boolean)
}
```

### Example: With Timeout Handling
```ts
const result = await execSafe('npm', ['install'], { timeout: 120_000 })

if (result.timedOut) {
  console.error('Installation timed out')
}
else if (!result.ok) {
  console.error(`Install failed (code ${result.code}): ${result.stderr}`)
}
```

## Related
- [Core](/core)
- [fs](/core/fs)
- [Sandbox feature](/features/sandbox)
