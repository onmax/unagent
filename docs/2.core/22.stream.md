---
icon: i-lucide-activity
---
# stream

> Stream handling utilities for agent responses. Create streamable results and parse/format Server-Sent Events (SSE).

## What It Solves

Streaming is the difference between “wait for a final answer” and “show progress as it happens”. The `stream` module helps you represent agent output as structured stream parts and expose them over HTTP using SSE. Use it to build CLIs, web UIs, or APIs that can consume partial output and tool events.

## When To Use It

- You want to stream text and tool activity to a client in real time.
- You need to format or parse SSE messages.
- You want a stream result that is easy to consume as an async iterable or HTTP `Response`.

## Usage
```ts
import { createStreamResult, formatSSE, parseSSE, SSEParser } from 'unagent/stream'
```

## API

### createStreamResult
Wraps an async iterable stream with helpers for consuming and converting to HTTP responses.

```ts
const result = createStreamResult({
  stream: agentStream,
  getValue: () => finalValue,
})

// Consume as async iterable
for await (const part of result.stream) {
  if (part.type === 'text')
    console.log(part.data)
  if (part.type === 'tool_call')
    console.log('Tool:', part.data.name)
}

// Or convert to Response
return result.toSSEResponse() // SSE format
return result.toResponse() // Plain text (text parts only)
```

### Stream Parts
```ts
type StreamPart
  = | { type: 'text', data: string }
    | { type: 'tool_call', data: { name: string, args: unknown } }
    | { type: 'tool_result', data: { name: string, result: unknown } }
    | { type: 'usage', data: UsageInfo }
    | { type: 'error', data: Error }
    | { type: 'done', data: null }
```

### SSE Formatting
#### `formatSSE(event, data)`

Formats data as SSE message.

```ts
formatSSE('text', { type: 'text', data: 'Hello' })
// "event: text\ndata: {"type":"text","data":"Hello"}\n\n"
```

### `parseSSE(line)`

Parses a single SSE line.

```ts
parseSSE('event: text') // { event: 'text' }
parseSSE('data: {"foo":1}') // { data: '{"foo":1}' }
parseSSE(': comment') // null
```

### SSEParser
Stateful parser for multi-line SSE chunks.

```ts
const parser = new SSEParser()

for (const chunk of incomingChunks) {
  const events = parser.parse(chunk)
  for (const { event, data } of events) {
    console.log(event, data)
  }
}
```

### Types
```ts
interface StreamResult<T> {
  readonly value: Promise<T>
  readonly stream: AsyncIterable<StreamPart>
  toResponse: () => Response // text/plain
  toSSEResponse: () => Response // text/event-stream
  consumeStream: () => Promise<void>
}

interface StreamResultOptions<T> {
  stream: AsyncIterable<StreamPart>
  getValue: () => Promise<T>
}
```

## Examples

### Example: HTTP Endpoint
```ts
import { createStreamResult } from 'unagent/stream'

export default defineEventHandler(async (event) => {
  const result = createStreamResult({
    stream: agent.run(prompt),
    getValue: () => agent.getFinalResponse(),
  })

  return result.toSSEResponse()
})
```

## Related
- [Core](/core)
- [tool](/core/tool)
- [usage](/core/usage)
