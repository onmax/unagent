---
icon: i-simple-icons-netlify
---

# Netlify

> Netlify Async Workloads provider for `unagent/jobs`.

## Usage

```ts
import { createJobs } from 'unagent/jobs'

const jobs = await createJobs({
  provider: {
    name: 'netlify',
    event: 'emails.send',
    apiKey: process.env.NETLIFY_API_KEY,
  },
  jobs: {
    'email:send': {
      async run(event) {
        return { result: { sent: true, to: event.payload.to } }
      },
    },
  },
})

const { messageId, sendStatus } = await jobs.enqueue('email:send', {
  to: 'hello@example.com',
}, {
  delaySeconds: 10,
  priority: 10,
})

if (sendStatus === 'failed')
  throw new Error(`job enqueue failed for message ${messageId}`)
```

## Scheduling

Use `delayUntil` for absolute or custom delay values:

```ts
await jobs.enqueue('email:send', { to: 'hello@example.com' }, {
  delayUntil: '2026-02-16T12:00:00Z',
  priority: 0,
})
```

If both are passed, `delayUntil` takes precedence over `delaySeconds`.

## Worker Handler

Use the provider handler for Netlify Async Workloads events:

```ts
const handler = jobs.netlify.handler
```

The handler:
- validates the event envelope
- resolves the named job
- runs it with context: `{ netlify: { eventName, eventId, attempt } }`
- throws on invalid/unknown jobs so Netlify retry behavior applies

## API

```ts
const netlify = jobs.netlify
netlify.event // default event configured in provider options
netlify.native // AsyncWorkloadsClient instance
netlify.handler // asyncWorkloadFn-wrapped event handler

await netlify.sendEnvelope({
  job: 'email:send',
  payload: { to: 'hello@example.com' },
  enqueuedAt: new Date().toISOString(),
}, {
  delayUntil: 5000,
  priority: 5,
})

const wrap = netlify.asyncWorkloadFn
const DoNotRetry = netlify.ErrorDoNotRetry
const RetryAfter = netlify.ErrorRetryAfterDelay
```

## Playground + Real Netlify E2E

The playground includes a Netlify jobs consumer at:

`playground/netlify/functions/jobs-background.mjs`

It listens to the jobs event configured by `NETLIFY_JOBS_EVENT` (defaults to `unagent.playground.jobs`) and writes deterministic receipts used by E2E checks.

Use `NETLIFY_ASYNC_WORKLOADS_BASE_URL` when you need to send to a custom Async Workloads endpoint; when omitted, the Netlify SDK default endpoint is used.

### Redeploy + Run E2E

```bash
pnpm playground:jobs:netlify:e2e -- --config /Users/maxi/unjs/unagent/playground/scripts/jobs-netlify-e2e.config.example.json
```

The E2E runner does:

- preview deploy bootstrap (`netlify deploy --json --dir="$PWD/public" --no-build`)
- jobs API checks (`supports`, `enqueue`)
- deterministic background trigger (`/.netlify/functions/jobs-background`) using the generated message ID
- receipt polling (`/api/jobs/netlify/receipts`) to prove background execution

## Related
- [Jobs](/features/jobs)
- [Task](/features/task)
- [Queue](/features/queue)
- [All Features](/features)
- [Core](/core)
