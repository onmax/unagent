---
icon: i-lucide-list-checks
---

# Task

> Define task handlers, attach cron schedules, and run them via native platform triggers. Inspired by [Nitro Tasks](https://nitro.build/guide/tasks).

## Usage

```ts
import { createTaskRunner } from 'unagent/task'
```

## Quick Start

```ts
const cleanup = {
  meta: { description: 'Clean up stale records' },
  async run(event) {
    return { result: { deleted: 42 } }
  },
}

const runner = createTaskRunner({
  tasks: { 'db:cleanup': cleanup },
  scheduledTasks: { '0 */6 * * *': 'db:cleanup' },
})

await runner.runTask('db:cleanup', { payload: { force: true } })
```

::note
Calling the same task with the same payload while it is already running returns the same promise. No duplicate execution occurs.
::

## Scheduling

Scheduling is platform-specific. The runner provides helpers for each target:

| Platform | Method | Description |
|----------|--------|-------------|
| Node/Bun/Deno | `startScheduler()` | In-process cron via [croner](https://github.com/hexagon/croner) |
| Cloudflare | `runCronTasks(cron)` | Called from `scheduled` handler |
| Vercel | `toVercelCrons()` | Generates `vercel.json` cron config |

## Platforms

- [Node](/features/task/node)
- [Cloudflare](/features/task/cloudflare)
- [Vercel](/features/task/vercel)

## Lazy Tasks

For code-splitting, pass a lazy entry with a `resolve` function instead of a `Task` object. The task is resolved on first invocation and cached.

```ts
const runner = createTaskRunner({
  tasks: {
    'db:cleanup': {
      meta: { description: 'Clean up stale records' },
      resolve: () => import('./tasks/cleanup').then(m => m.default),
    },
  },
})
```

## API

### `createTaskRunner(options)`

Create a runner with registered tasks and optional cron schedules.

**Options:**
- `tasks` — `Record<string, TaskEntry>` of named task handlers (plain `Task` objects or lazy `{ resolve, meta? }` entries)
- `scheduledTasks` — `Record<string, string | string[]>` mapping cron expressions to task names

**Returns `TaskRunner`:**
- `runTask(name, options?)` — execute a task by name
- `listTasks()` — list all registered tasks with metadata
- `scheduledTasks` — normalized schedule map (cron → string[])
- `getCronTasks(cron)` — get task names for a cron expression
- `runCronTasks(cron, options?)` — run all tasks for a cron expression
- `startScheduler()` — start in-process cron scheduler, returns stop function

### `toVercelCrons(scheduledTasks, basePath?)`

Convert scheduled tasks to Vercel cron config format.

### `toCloudflareCrons(scheduledTasks)`

Extract cron expressions for `wrangler.toml` triggers.

## Related
- [All Features](/features)
- [Core](/core)
